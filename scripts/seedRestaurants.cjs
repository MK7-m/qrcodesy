require('ts-node/register/transpile-only');
// @ts-nocheck require('dotenv/config'); const { createClient } = require('@supabase/supabase-js'); const { randomUUID } = require('node:crypto'); const { RESTAURANTS } = require('../src/data/restaurant');  const supabaseUrl = process.env.VITE_SUPABASE_URL ?? process.env.SUPABASE_URL; const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY; const ownerId = process.env.SEED_OWNER_ID;  if (!supabaseUrl) {   throw new Error('Missing VITE_SUPABASE_URL (or SUPABASE_URL) environment variable.'); }  if (!serviceRoleKey) {   throw new Error('Missing SUPABASE_SERVICE_ROLE_KEY environment variable. Please provide a service role key for seeding.'); }  if (!ownerId) {   throw new Error('Missing SEED_OWNER_ID environment variable. Set it to the auth.users id that should own the restaurants.'); }  const supabase = createClient(supabaseUrl, serviceRoleKey, {   auth: { persistSession: false }, });  const planCycle = ['c', 'b', 'a'];  function normalizeStatus(status) {   if (!status) return 'auto';   if (status.includes('مغلق')) return 'closed';   if (status.includes('مفتوح')) return 'open';   return 'auto'; }  function splitLocation(location) {   if (!location) {     return { city: 'دمشق', area: null };   }    const [areaPart] = location.split('–').map((part) => part.trim());   return {     city: 'دمشق',     area: areaPart || null,   }; }  function buildOpeningHours(item) {   return {     status: item.openStatus,     hours: item.openHours,     deliveryEstimate: item.deliveryEstimate,   }; }  async function run() {   const now = new Date().toISOString();    const payload = RESTAURANTS.map((restaurant, index) => {     const plan = planCycle[index % planCycle.length];     const { city, area } = splitLocation(restaurant.location);      return {       id: randomUUID(),       owner_id: ownerId,       name: restaurant.name,       description: restaurant.bio,       short_description: restaurant.tagline,       long_description: restaurant.bio,       cuisine_summary: restaurant.tagline,       phone_number: restaurant.phone,       whatsapp_number: restaurant.whatsapp,       phone: restaurant.phone,       whatsapp: restaurant.whatsapp,       delivery_fee: restaurant.deliveryFee ?? 0,       plan,       city,       area,       address_landmark: restaurant.location,       opening_hours: buildOpeningHours(restaurant),       status_override: normalizeStatus(restaurant.openStatus),       rating: restaurant.rating,       rating_count: 120 + index * 10,       is_active: true,       cover_images: null,       cover_image_url: null,       logo_url: null,       extra_fees: null,       created_at: now,       updated_at: now,     };   });    console.log(`Seeding ${payload.length} restaurants as owner ${ownerId}...`);    const { data, error } = await supabase     .from('restaurants')     .upsert(payload, { onConflict: 'phone_number' })     .select('id, name, phone_number');    if (error) {     console.error('Failed to upsert restaurants:', error);     process.exit(1);   }    console.table(data);   console.log('Seed completed successfully.'); }  run().catch((err) => {   console.error(err);   process.exit(1); });
